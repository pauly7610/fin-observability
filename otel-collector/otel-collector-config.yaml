extensions:
  basicauth/grafana_cloud:
    client_auth:
      username: "${GRAFANA_CLOUD_INSTANCE_ID}"
      password: "${GRAFANA_CLOUD_API_TOKEN}"

receivers:
  otlp:
    protocols:
      grpc:
        endpoint: "0.0.0.0:4317"
      http:
        endpoint: "0.0.0.0:4318"

processors:
  batch:
    timeout: 5s
    send_batch_size: 1024
  resourcedetection:
    detectors: ["env", "system"]
    override: false

exporters:
  # Logs telemetry to stdout — useful for Railway log viewer
  logging:
    verbosity: normal
    sampling_initial: 5
    sampling_thereafter: 200

  # ── Grafana Cloud ──
  otlphttp/grafana_cloud:
    endpoint: "https://otlp-gateway-prod-us-east-3.grafana.net/otlp"
    auth:
      authenticator: basicauth/grafana_cloud

  # ── Honeycomb ──
  # Uncomment to forward to Honeycomb.
  # Set HONEYCOMB_API_KEY as an env var in Railway.
  # otlp/honeycomb:
  #   endpoint: "api.honeycomb.io:443"
  #   headers:
  #     x-honeycomb-team: "${HONEYCOMB_API_KEY}"

  # ── Axiom ──
  # Uncomment to forward to Axiom.
  # Set AXIOM_API_TOKEN and AXIOM_DATASET as env vars in Railway.
  # otlphttp/axiom:
  #   endpoint: "https://api.axiom.co"
  #   headers:
  #     Authorization: "Bearer ${AXIOM_API_TOKEN}"
  #     X-Axiom-Dataset: "${AXIOM_DATASET}"

service:
  extensions: [basicauth/grafana_cloud]
  pipelines:
    traces:
      receivers: [otlp]
      processors: [resourcedetection, batch]
      exporters: [logging, otlphttp/grafana_cloud]
    metrics:
      receivers: [otlp]
      processors: [resourcedetection, batch]
      exporters: [logging, otlphttp/grafana_cloud]
    logs:
      receivers: [otlp]
      processors: [resourcedetection, batch]
      exporters: [logging, otlphttp/grafana_cloud]
